(window.webpackJsonp=window.webpackJsonp||[]).push([[16],{565:function(s,e,a){"use strict";a.r(e);var t=a(6),n=Object(t.a)({},(function(){var s=this,e=s.$createElement,a=s._self._c||e;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("p",[s._v("使用 Docker 官方的 Registry 创建的仓库，面临着这样的问题，比如删除镜像后空间默认不会回收，造成空间被占用。比较常见的做法是使用 Nexus 来管理企业的工具包。")]),s._v(" "),a("p",[s._v("Nexus 不仅可以创建 Docker 仓库，也可以 NPM、Maven 等多种类型的仓库。")]),s._v(" "),a("h2",{attrs:{id:"启动-nexus-容器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#启动-nexus-容器"}},[s._v("#")]),s._v(" 启动 Nexus 容器")]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[s._v("$ docker run -d --name nexus3 --restart"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("always "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    -p "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8081")]),s._v(":8081 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    -p "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("8082")]),s._v(":8082 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    --mount "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("src")]),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("nexus-data,target"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/nexus-data "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    sonatype/nexus3\nUnable to "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("find")]),s._v(" image "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'sonatype/nexus3:latest'")]),s._v(" locally\nlatest: Pulling from sonatype/nexus3\nc65691897a4d: Pull complete\n641d7cc5cbc4: Pull complete\nc508b13320cd: Pull complete\n79e3bf9d3132: Pull complete\nDigest: sha256:2c33632ccd8f8c5f9023a3d7f5f541e271833e402219f8c5a83a29d1721457ca\nStatus: Downloaded newer image "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" sonatype/nexus3:latest\nf637e039214978f8aac41e621e51588bd8cd8438055498c4060fbaf87799e64f\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br")])]),a("p",[a("strong",[s._v("其中 8081 为 Nexus 的访问端口，8082 为仓库的端口")]),s._v("，网上大部分文章并没有加上 8082 端口的映射，导致我在测试的时候卡了很久。")]),s._v(" "),a("p",[s._v("稍等一两分钟，浏览器打开 "),a("code",[s._v("domain:8081")]),s._v("。")]),s._v(" "),a("p",[s._v("点击右上角 "),a("code",[s._v("Sign in")]),s._v(" 进行登录，初始账号为 "),a("code",[s._v("admin")]),s._v("，密码可以通过 "),a("code",[s._v("exec")]),s._v(" 命令进入容器内，根据提示的路径查看初始密码。")]),s._v(" "),a("p",[a("img",{attrs:{src:"/imgs/docker/4.png",alt:"登录页"}})]),s._v(" "),a("p",[s._v("进入容器查看初始密码")]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ docker "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" -it f637 /bin/bash\nbash-4.4$ "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("vi")]),s._v(" /nexus-data/admin.password\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br")])]),a("p",[s._v("登陆后会被要求修改密码，以后将使用这密码。")]),s._v(" "),a("h2",{attrs:{id:"创建仓库"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#创建仓库"}},[s._v("#")]),s._v(" 创建仓库")]),s._v(" "),a("p",[s._v("点击导航的齿轮按钮进入设置页面，进入 "),a("code",[s._v("Repository->Repositories")]),s._v(" 点击 "),a("code",[s._v("Create repository")]),s._v(" 选择 "),a("code",[s._v("docker (hosted)")])]),s._v(" "),a("p",[a("code",[s._v("docker (hosted)")]),s._v(" 为本地仓库，"),a("code",[s._v("docker (proxy)")]),s._v(" 为代理仓库，"),a("code",[s._v("docker (group)")]),s._v(" 为聚合仓库，本文只介绍本地仓库，如果有兴趣也可以到网上查找另外两种仓库的用法。")]),s._v(" "),a("p",[a("img",{attrs:{src:"/imgs/docker/5.png",alt:"创建仓库"}})]),s._v(" "),a("p",[s._v("只需要填好上图中红框的部分即可，其中 "),a("code",[s._v("Name")]),s._v(" 为仓库名，"),a("code",[s._v("HTTP")]),s._v(" 的输入框则是填写端口号 8082，写好之后滑到页面底部，点击 "),a("code",[s._v("Create repository")]),s._v(" 即创建仓库。")]),s._v(" "),a("h2",{attrs:{id:"添加访问权限"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#添加访问权限"}},[s._v("#")]),s._v(" 添加访问权限")]),s._v(" "),a("p",[s._v("菜单 Security->Realms 把 Docker Bearer Token Realm 移到右边的框中保存。")]),s._v(" "),a("p",[s._v("添加用户规则：菜单 Security->Roles->Create role 在 Privlleges 选项搜索 docker 把相应的规则移动到右边的框中然后保存。")]),s._v(" "),a("p",[s._v("添加用户：菜单 Security->Users->Create local user 在 Roles 选项中选中刚才创建的规则移动到右边的窗口保存。")]),s._v(" "),a("h2",{attrs:{id:"登录仓库"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#登录仓库"}},[s._v("#")]),s._v(" 登录仓库")]),s._v(" "),a("p",[s._v("因为是创建的仓库是用 HTTP 的方式访问的，所以在登录前需要修改 Docker 配置中的 Daemon")]),s._v(" "),a("p",[a("code",[s._v('{ "insecure-registries": ["domain:8082"] }')])]),s._v(" "),a("div",{staticClass:"language-sh line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("$ docker login domain:8082\nUsername: yourName\nPassword:\nLogin Succeeded\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br")])]),a("p",[s._v("上传仓库、下载仓库、搜索仓库 这些内容与上一篇文章中的一致，这里就不再赘述了。")]),s._v(" "),a("p",[a("strong",[s._v("其中需要注意的点为启动 Nexus 时，需要把仓库的端口一起映射到宿主机中。")])]),s._v(" "),a("hr"),s._v(" "),a("p",[s._v("如果你喜欢我的文章，希望可以关注一下我的公众号【前端develop】")]),s._v(" "),a("p",[a("img",{attrs:{src:"/imgs/qrcode.png",alt:"前端develop"}})])])}),[],!1,null,null,null);e.default=n.exports}}]);